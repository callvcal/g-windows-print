name: Build g_windows_print Example (Windows) - Fast Debug

on:
  workflow_dispatch:

jobs:
  build-example-debug:
    name: Build Example Windows App (Debug)
    runs-on: windows-latest

    env:
      FLUTTER_CACHE_DIR: C:\hostedtoolcache\windows\flutter

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # ================= Flutter SDK Cache =================
      - name: Cache Flutter SDK
        uses: actions/cache@v3
        with:
          path: ${{ env.FLUTTER_CACHE_DIR }}
          key: flutter-${{ runner.os }}-${{ hashFiles('example/pubspec.yaml') }}
          restore-keys: |
            flutter-${{ runner.os }}-

      # ================= Set up Flutter =================
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: "3.27.1"
          channel: stable

      - name: Enable Windows Desktop
        run: flutter config --enable-windows-desktop

      # ================= Install Dependencies =================
      - name: Install Dependencies
        run: flutter pub get
        working-directory: example

      # ================= Pre-build plugin =================
      - name: Pre-build Flutter Plugins
        run: flutter build windows --debug --no-build
        working-directory: example

      # ================= Build Example (Debug) =================
      - name: Build Windows Debug
        run: flutter build windows --debug
        working-directory: example

      # ================= Upload Debug Artifacts =================
      - name: Upload Debug Build Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: g_windows_print-example-windows-debug
          path: example/build/windows/x64/runner/Debug/
